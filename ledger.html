<!DOCTYPE html>
<html>
<head>
    <title>User Ledger</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 15px;
        }

        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin-top: 20px; 
        }
        th, td { 
            border: 1px solid #000; 
            padding: 10px; 
            text-align: left; 
        }

        /* Responsive */
        @media (max-width: 600px) {
            th, td {
                padding: 6px;
                font-size: 14px;
            }
        }

        .right {
            text-align: right;
        }
    </style>
</head>
<body>

<h2 id="partyTitle"></h2>

<table id="invoiceTable">
    <tr>
        <th>Date</th>
        <th>Type</th>
        <th>No</th>
        <th>Debit</th>
        <th>Credit</th>
        <th>Balance</th>
        <th>Download</th>
    </tr>
</table>

<script>

// âš¡ GET LOGGED USER ID
const userId = localStorage.getItem("loggedUser");

if (!userId) {
    alert("No user logged in!");
    window.location.href = "login.html";
}

// Update title
document.getElementById("partyTitle").innerText = userId.toUpperCase() + " Ledger";

// JSON path becomes bill/userid/userid.json
const jsonPath = `bill/${userId}/${userId}.json`;

fetch(jsonPath)
    .then(res => res.json())
    .then(data => {

        // ðŸ”„ Convert Tally fields â†’ Your required fields
        const convertedData = data.map(item => ({
            date: item["Date"] || "",
            type: item["Vch Type"] || item["Particulars"] || "",
            no: item["Vch No."] || "",
            debit: item["Debit"] || "",
            credit: item["Credit"] || "",
            download: "" // Tally does not give files
        }));

        const table = document.getElementById("invoiceTable");
        let balance = 0;

        convertedData.forEach(inv => {
            let debit = Number(inv.debit) || 0;
            let credit = Number(inv.credit) || 0;

            balance += debit - credit;

            let row = `
                <tr>
                    <td>${inv.date}</td>
                    <td>${inv.type}</td>
                    <td>${inv.no}</td>
                    <td class="right">${debit ? "â‚¹" + debit : ""}</td>
                    <td class="right">${credit ? "â‚¹" + credit : ""}</td>
                    <td class="right">â‚¹${balance.toFixed(2)}</td>
                    <td></td>
                </tr>
            `;

            table.innerHTML += row;
        });

        // Closing balance row
        table.innerHTML += `
            <tr>
                <th colspan="5" class="right">Closing Balance</th>
                <th class="right">â‚¹${balance.toFixed(2)}</th>
                <th></th>
            </tr>
        `;
    })
    .catch(err => {
        document.body.innerHTML += "<p style='color:red;'>Error loading ledger data.</p>";
    });

</script>

</body>
</html>
